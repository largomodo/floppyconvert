# Floppy Conversion Tool - Code Index

| File | What | When |
|------|------|------|
| `pom.xml` | Maven build configuration: Java 21, JUnit 5, Commons Exec, Picocli 4.7.7, SLF4J API, Logback Classic dependencies | Modifying dependencies, build settings, or JAR manifest |
| `src/main/java/de/nrq/floppyconvert/App.java` | CLI entry point: Picocli-based argument parsing with @Command/@Parameters/@Option annotations, SLF4J Logger, MDC context management, --verbose flag for DEBUG level, automatic help generation, smart defaults for output directory (. for files, input/output for directories), single positional input parameter replaces --input-file/--input-dir, no --empty-image option (template bundled as JAR resource), no --mtools-path option (native FAT12 engine), implements Callable<Integer> | Adding CLI arguments, changing argument defaults, debugging argument validation, understanding Picocli pattern, modifying log verbosity behavior |
| `src/main/resources/logback.xml` | Logback configuration: three appenders (STDOUT, FILE, FAILURES), MDC pattern %X{rom} for thread context, INFO default level | Modifying log output format, changing log levels, debugging logging issues |
| `src/main/java/de/nrq/floppyconvert/core/CopierFormat.java` | Enum for backup unit formats (FIG/SWC/UFO/GD3) with ucon64 command flags | Adding new format support or changing format-specific behavior |
| `src/main/java/de/nrq/floppyconvert/core/FloppyType.java` | Enum for floppy disk formats (720KB/1.44MB/1.6MB) with capacity limits and bestFit() selection logic | Adding new disk format or debugging capacity errors |
| `src/main/java/de/nrq/floppyconvert/core/DiskTemplateFactory.java` | Interface for floppy disk template providers | Adding alternative template sources or understanding template abstraction |
| `src/main/java/de/nrq/floppyconvert/core/ResourceDiskTemplateFactory.java` | Loads floppy disk templates from JAR classpath resources | Debugging template loading failures or modifying resource paths |
| `src/main/java/de/nrq/floppyconvert/core/RomPartComparator.java` | Universal comparator for ROM part sorting (numeric extensions + alphanumeric filenames) | Debugging sort order issues or extending to new naming patterns |
| `src/main/java/de/nrq/floppyconvert/core/RomPartNormalizer.java` | Stateless utility for ROM part filename sanitization and metadata generation | Debugging filename sanitization issues, shell compatibility problems, or understanding metadata creation |
| `src/main/java/de/nrq/floppyconvert/core/RomProcessor.java` | ROM processing pipeline orchestrator with DI, SLF4J logger for status output, ~235 lines, coordinates DiskPacker/RomSplitter/FloppyImageWriter/DiskTemplateFactory/RomPartNormalizer via ConversionWorkspace, includes output directory structure handling and interrupt-safe cleanup | Changing disk spanning logic, debugging DOS name collisions, modifying pipeline flow, understanding orchestration pattern, troubleshooting dependency injection |
| `src/main/java/de/nrq/floppyconvert/core/domain/RomPartMetadata.java` | Domain record for ROM part metadata (path, size, DOS name) with null validation | Understanding DiskPacker input format, debugging validation errors |
| `src/main/java/de/nrq/floppyconvert/core/domain/DiskLayout.java` | Domain record for disk contents and floppy type | Understanding DiskPacker output format |
| `src/main/java/de/nrq/floppyconvert/core/domain/DiskPacker.java` | Bin-packing algorithm interface | Adding alternative packing strategies |
| `src/main/java/de/nrq/floppyconvert/core/domain/GreedyDiskPacker.java` | First-fit decreasing bin-packing implementation | Debugging disk capacity issues or modifying packing algorithm |
| `src/main/java/de/nrq/floppyconvert/core/workspace/ConversionWorkspace.java` | AutoCloseable workspace for artifact tracking and cleanup with interrupt flag handling, SLF4J logger for warnings; thread-safe when each instance confined to single thread (no shared workspace directories) | Understanding resource management pattern, debugging cleanup issues, troubleshooting interrupt behavior, understanding promoteToFinal atomic move pattern |
| `src/main/java/de/nrq/floppyconvert/core/ConversionObserver.java` | Observer interface for batch processing events | Adding progress monitoring or telemetry |
| `src/main/java/de/nrq/floppyconvert/service/RomSplitter.java` | Interface for ROM splitting adapters | Adding alternative ROM splitting tools |
| `src/main/java/de/nrq/floppyconvert/service/FloppyImageWriter.java` | Interface for floppy image injection adapters | Adding alternative floppy image tools |
| `src/main/java/de/nrq/floppyconvert/service/ExternalProcessDriver.java` | Base class for external process execution with timeout and exit code validation | Changing timeout behavior, process error handling, or adding new external tools |
| `src/main/java/de/nrq/floppyconvert/service/Ucon64Driver.java` | Wrapper for ucon64 ROM splitting: work-in-place with absolute path input, SLF4J logger for warnings, automatic retry (4→12 Mbit escalation), intermediate file cleanup after split, format parameter, and filter-based discovery | Changing ucon64 command-line flags, understanding two-step conversion cleanup, split file discovery logic, or retry behavior |
| `src/main/java/de/nrq/floppyconvert/service/fat/Fat12ImageWriter.java` | Native Java FAT12 image writer: memory-mapped I/O, little-endian ByteBuffer, BPB parsing, cluster chaining, FAT mirroring | Debugging FAT12 write operations, understanding native implementation |
| `src/main/java/de/nrq/floppyconvert/util/DosNameUtil.java` | DOS 8.3 filename sanitization logic | Changing filename truncation, special character handling, or extension preservation |
| `src/test/java/de/nrq/floppyconvert/core/RomPartComparatorTest.java` | Test cases for universal ROM part sorting (numeric and alphanumeric) | Verifying sort behavior for new format or edge cases |
| `src/test/java/de/nrq/floppyconvert/util/DosNameUtilTest.java` | Test cases for DOS naming edge cases | Adding new filename sanitization scenarios |
| `src/test/java/de/nrq/floppyconvert/util/TestUcon64PathResolver.java` | Test utility for ucon64 binary path resolution: checks PATH first, falls back to classpath resource /ucon64 | Updating test setup, adding new tests requiring ucon64, debugging test skips |
| `src/test/resources/logback-test.xml` | Test logging config: WARN threshold to suppress test noise | Debugging test log output |
| `src/test/java/de/nrq/floppyconvert/AppLoggingTest.java` | Test cases for logging: verbose flag, MDC context propagation, failures appender | Verifying logging behavior |
| `src/test/java/de/nrq/floppyconvert/service/Ucon64DriverTest.java` | Test cases for ucon64 process execution: command-line arguments, retry mechanism (4→12 Mbit), error handling | Verifying ucon64 command-line arguments, timeout behavior, or retry logic for large ROMs |
| `src/test/java/de/nrq/floppyconvert/service/fat/Fat12ImageWriterTest.java` | Unit tests for native FAT12 writer: cluster allocation, FAT mirroring, directory entries, disk full scenarios | Verifying FAT12 operations, adding test cases for edge cases |
| `src/test/java/de/nrq/floppyconvert/core/domain/RomPartMetadataTest.java` | Unit tests for RomPartMetadata record: validation, immutability | Verifying domain record behavior |
| `src/test/java/de/nrq/floppyconvert/core/domain/DiskLayoutTest.java` | Unit tests for DiskLayout record: immutability, list wrapping | Verifying domain record behavior |
| `src/test/java/de/nrq/floppyconvert/core/domain/GreedyDiskPackerTest.java` | Unit tests for bin-packing algorithm: empty input, single disk, multi-disk spanning, oversized parts | Debugging packing behavior or adding test cases |
| `src/test/java/de/nrq/floppyconvert/core/workspace/ConversionWorkspaceTest.java` | Unit tests for workspace cleanup: tracked files, final outputs, nested directories, Windows locking | Debugging cleanup issues or validating AutoCloseable contract |
| `src/test/java/de/nrq/floppyconvert/core/RomProcessorTest.java` | Unit tests for RomProcessor with mocked dependencies: delegation, exception handling, workspace cleanup | Debugging orchestration logic without external tools |
| `src/test/java/de/nrq/floppyconvert/AppConcurrencyTest.java` | Integration tests for concurrent batch processing: workspace isolation, observer thread-safety, graceful shutdown | Debugging concurrency issues or validating thread pool behavior |
| `src/test/java/de/nrq/floppyconvert/AppE2ETest.java` | E2E tests for full conversion pipeline across all formats (FIG/SWC/UFO/GD3) with real ROM files | Debugging conversion failures, adding new format support, validating pipeline changes |
| `src/test/java/de/nrq/floppyconvert/AppRecursionTest.java` | Integration tests for recursive directory traversal: deep nesting, sibling directories, root-level files, symlink behavior | Debugging structure preservation, verifying recursive traversal behavior, validating path mirroring |
| `README.md` | Architecture overview, usage examples for all formats, build instructions | Understanding system design or running the tool |
| `PRELIMINARY-IMPLEMENTATION-PLAN.md` | Original design specification | Understanding historical context or design rationale |
| `implementation-plan-floppy-conversion.md` | Detailed implementation plan with milestones | Understanding implementation strategy or reviewing decisions |
| `implementation-plan-floppy-conversion-extension-ANNOTATED.md` | Multi-format extension plan with decision rationale | Understanding multi-format feature design or reviewing tradeoffs |
